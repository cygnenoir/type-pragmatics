Module(
  "encodingcompstudy.TStore"
, [Import("encodingcompstudy.Tables", None())]
, [ Sorts([SortDef("TStore"), SortDef("TName"), SortDef("OptTable")])
  , Constructors(
      [ ConstructorDecl("noTable", [], SortRef("OptTable"))
      , ConstructorDecl("someTable", [SortRef("Table")], SortRef("OptTable"))
      ]
    )
  , Functions(
      [ FunctionDef(
          FunctionSig("isSomeTable", [SortRef("OptTable")], SortRef("Bool"))
        , [ FunctionEq("isSomeTable", [FunctionPatVar("noTable")], FunctionExpFalse())
          , FunctionEq(
              "isSomeTable"
            , [FunctionPatApp("someTable", [FunctionPatVar("t")])]
            , FunctionExpTrue()
            )
          ]
        )
      ]
    )
  , PartialFunctions(
      [ FunctionDef(
          FunctionSig("getSomeTable", [SortRef("OptTable")], SortRef("Table"))
        , [ FunctionEq(
              "getSomeTable"
            , [FunctionPatApp("someTable", [FunctionPatVar("t")])]
            , FunctionExpVar("t")
            )
          ]
        )
      ]
    )
  , Constructors(
      [ ConstructorDecl("emptyStore", [], SortRef("TStore"))
      , ConstructorDecl(
          "bindStore"
        , [SortRef("TName"), SortRef("Table"), SortRef("TStore")]
        , SortRef("TStore")
        )
      ]
    )
  , Functions(
      [ FunctionDef(
          FunctionSig(
            "lookupStore"
          , [SortRef("TName"), SortRef("TStore")]
          , SortRef("OptTable")
          )
        , [ FunctionEq(
              "lookupStore"
            , [FunctionPatVar("n"), FunctionPatVar("emptyStore")]
            , FunctionExpVar("noTable")
            )
          , FunctionEq(
              "lookupStore"
            , [ FunctionPatVar("n")
              , FunctionPatApp(
                  "bindStore"
                , [FunctionPatVar("m"), FunctionPatVar("t"), FunctionPatVar("TS")]
                )
              ]
            , FunctionExpIf(
                FunctionExpEq(FunctionExpVar("n"), FunctionExpVar("m"))
              , FunctionExpApp("someTable", [FunctionExpVar("t")])
              , FunctionExpApp("lookupStore", [FunctionExpVar("n"), FunctionExpVar("TS")])
              )
            )
          ]
        )
      ]
    )
  ]
)